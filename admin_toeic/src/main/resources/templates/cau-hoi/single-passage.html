<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Single passage</title>
    <th:block th:replace="fragment/header :: html_head"></th:block>
    <style>
        .dropdown-item{
            width: -webkit-fill-available;
        }
    </style>

</head>

<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="loader">
            <svg class="circular" viewBox="25 25 50 50">
                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="3" stroke-miterlimit="10" />
            </svg>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    
    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div th:replace="fragment/header :: nav_header">
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->

        <!--**********************************
            Header start
        ***********************************-->
        <div th:replace="fragment/header :: header">
        </div>
        <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

        <!--**********************************
            Sidebar start
        ***********************************-->
        <div th:replace="fragment/header :: nk_sidebar"></div>
        <!--**********************************
            Sidebar end
        ***********************************-->

        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">

            <div class="row page-titles mx-0">
                <div class="col p-md-0">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="javascript:void(0)">Bảng điều khiển</a></li>
                        <li class="breadcrumb-item active"><a href="javascript:void(0)">Single passage</a></li>
                    </ol>
                </div>
            </div>
            <!-- row -->

            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                               
                               <div class="d-flex justify-content-end">
                                   <a type="button" class="btn btn-danger" th:href="@{/admin/manage-question}">
                                       Hủy </a>
                                <button type="button" id="submitButton" class="btn btn-info ml-4">
                                    Lưu câu hỏi</button>
                               </div>

                              
                               <!-- start tab -->
                           
                            <div class="row align-items-center">
                                     
                             <div class="col-12" id="wrapper">
                                        
                            </div>
                             </div>
                               <!--end tab  -->

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- #/ container -->
        </div>
        <!--**********************************
            Content body end
        ***********************************-->
        
        
        <!--**********************************
            Footer start
        ***********************************-->
        <div th:replace="fragment/footer :: footer">
        </div>
        <!--**********************************
            Footer end
        ***********************************-->
    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->



    <!--**********************************
        Scripts
    ***********************************-->
    <script th:src="@{/plugins/toastr/js/toastr.min.js}"></script>
    <script th:src="@{/plugins/toastr/js/toastr.init.js}"></script>
    <script th:src="@{/plugins/common/common.min.js}"></script>
    <script th:src="@{/js/custom.min.js}"></script>
    <script th:src="@{/js/settings.js}"></script>
    <script th:src="@{/js/gleek.js}"></script>
    <script th:src="@{/js/styleSwitcher.js}"></script>

    <script th:src="@{/plugins/tables/js/jquery.dataTables.min.js}"></script>
    <script th:src="@{/plugins/tables/js/datatable/dataTables.bootstrap4.min.js}"></script>
    <script th:src="@{/plugins/tables/js/datatable-init/datatable-basic.min.js}"></script>


    <script th:src="@{/plugins/summernote/dist/summernote.min.js}"></script>
    <script th:src="@{/plugins/summernote/dist/summernote-init.js}"></script>
    <script th:src="@{/plugins/summernote/js/summernote-audio.js}"></script>

    <script th:src="@{/js/cau-hoi/single-passage.js}"></script>
    <style>
        .file-input + .file-label {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .file-input {
            width: 0;
            height: 0;
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
        }

        .file-label {
            width: 200px;
            display: inline-block;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .file-label:hover {
            background-color: #e9e9e9;
        }

    </style>
   <script>
     $(document).ready(function() {
    // Khởi tạo Summernote cho các textarea có sẵn khi trang được tải
    $('textarea[name^="description"]').each(function() {
        $(this).summernote({
            // Các tùy chọn cấu hình cho Summernote
        });
    });
});
   </script>

  <script type="module">
      import axios from 'https://cdn.skypack.dev/axios';
      // Chuyển đổi file ảnh thành chuỗi Base64
      function convertFileToBase64(file) {
          return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.readAsDataURL(file);
              reader.onload = () => resolve(reader.result);
              reader.onerror = error => reject(error);
          });
      }

      async function createAndSendQuestionObject(name,description,questions) {
          var urlParams = new URLSearchParams(window.location.search);
          var level = urlParams.get('level');
          var type = urlParams.get('type');

          // Tạo một đối tượng mới theo mẫu cho câu hỏi

          var questionObject = {
              id:null,
              name:name ? name : null,
              level: level,
              type: type,
              description:description,
              questions:questions
          };
          console.log(questionObject)
          // Đoạn code gửi API sẽ được thêm ở đây
          try {
              const response = await axios.post('/api/question/save/single-passage',questionObject, {
                  headers: {
                      'Content-Type': 'application/json'
                  }
              });
              console.log(response)
              toastr.success("Thông tin đã được cập nhật", "Thành công", {
                  timeOut: 10e3,
                  closeButton: !0,
                  debug: !1,
                  newestOnTop: !0,
                  progressBar: !0,
                  positionClass: "toast-top-right",
                  preventDuplicates: !0,
                  onclick: null,
                  showDuration: "5000",
                  hideDuration: "5000",
                  extendedTimeOut: "5000",
                  showEasing: "swing",
                  hideEasing: "linear",
                  showMethod: "fadeIn",
                  hideMethod: "fadeOut",
                  tapToDismiss: !1
              });
              setTimeout(() => {
                  // Chuyển hướng (redirect) đến URL '/admin/manage-question'
                  window.location.href = '/admin/manage-question';
              }, 2000); // 1000 milliseconds = 1 giây
              // updateImageInfo(nameImage, linkImage);

          } catch (error) {
              console.log(error)
              toastr.error(error.response.data, "Thất baị", {
                  timeOut: 10e3,
                  closeButton: !0,
                  debug: !1,
                  newestOnTop: !0,
                  progressBar: !0,
                  positionClass: "toast-top-right",
                  preventDuplicates: !0,
                  onclick: null,
                  showDuration: "5000",
                  hideDuration: "5000",
                  extendedTimeOut: "5000",
                  showEasing: "swing",
                  hideEasing: "linear",
                  showMethod: "fadeIn",
                  hideMethod: "fadeOut",
                  tapToDismiss: !1
              });
          }
      }


      document.getElementById("submitButton").addEventListener("click", function() {
          // Lấy thông tin về hình ảnh
          var name = document.getElementById('name').value;
          // Lấy value textare sum note
          var description = document.getElementById('description').value;

          var questionsWrapper = document.querySelectorAll(".wrapper-question");

          var questions = [];
          questionsWrapper.forEach((ques)=>{

              var index = ques.className.split(" ")[2].split("-")[1];
              var nameQuestion = document.getElementById(`question-name-${index}`);
              var answerCorrect = document.getElementById(`question-correct-${index}`);
              var answersTagName = document.getElementsByName(`question-${index}`);
              var answer =[];
              answersTagName.forEach((ans)=>{
                  answer.push(ans.value);
              });
              var question = {
                  name:nameQuestion.value,
                  answerCorrect:answerCorrect.value,
                  answers:answer
              }
              questions.push(question);
          });
          createAndSendQuestionObject( name,description,questions);

      });
  </script>
 
</body>

</html>